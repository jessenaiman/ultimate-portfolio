--- 
// @ts-ignore – Astro component
import { Icon } from "astro-icon/components";
import { navigationItems } from "../../data/navigation";
import ThemeController from "./ThemeController.astro";
import type { NavigationItem } from "../../data/navigation";

/*
  ===== DaisyUI navbar & theme-controller =====
  – All layout/spacing handled by daisyUI + Tailwind utilities.
  – No bespoke CSS so we always stay visually consistent with the framework.
*/

// Detect active route
const currentPath = Astro.url.pathname;
const isActive = (path: string): boolean => {
  if (!path || path === "#") return false;
  const cleanCurrent = currentPath.replace(/\/+$/, "").toLowerCase();
  const cleanTarget = path.replace(/\/+$/, "").toLowerCase();
  // Special case for home page
  if (path === "/") {
    return cleanCurrent === "" || cleanCurrent === "/";
  }
  // For other pages, check if the current path ends with the target path
  return cleanCurrent.endsWith(cleanTarget);
};

// Navigation data
const nav: NavigationItem[] = navigationItems;

// List of themes for the ThemeController
const themes = [
  "light",
  "dark",
  "cupcake",
  "bumblebee",
  "autumn",
  "modern-light",
];
---

<div class="navbar bg-base-100 sticky top-0 z-50 shadow-sm">
  <!-- Navbar Start (Logo) -->
  <div class="navbar-start">
    <a href="/" class="btn btn-ghost text-xl normal-case">
      Portfolio
    </a>
  </div>

  <!-- Navbar Center (Desktop Menu) -->
  <div class="navbar-center hidden lg:flex">
    <ul class="menu menu-horizontal px-1">
      {nav.map((item) => (
        !item.children ? (
          <li>
            <a href={item.path} class:list={[isActive(item.path) ? "active" : ""]}>
              {item.displayName}
            </a>
          </li>
        ) : (
          <li>
            <details>
              <summary>{item.displayName}</summary>
              <ul class="p-2 bg-base-100 rounded-t-none shadow-lg">
                {item.children.map((child) => (
                  <li>
                    <a href={child.path} class:list={[isActive(child.path) ? "active" : ""]}>
                      {child.displayName}
                    </a>
                  </li>
                ))}
              </ul>
            </details>
          </li>
        )
      ))}
    </ul>
  </div>

  <!-- Navbar End (Theme Controller & Mobile Menu) -->
  <div class="navbar-end">
    <!-- Theme Controller -->
    <ThemeController {themes} />

    <!-- Mobile Menu Dropdown -->
    <div class="dropdown dropdown-end lg:hidden">
      <label tabindex="0" class="btn btn-ghost lg:hidden">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
        </svg>
      </label>
      <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">
        {nav.map((item) => (
          !item.children ? (
            <li>
              <a href={item.path} class:list={[isActive(item.path) ? "active" : ""]}>
                {item.displayName}
              </a>
            </li>
          ) : (
            <li>
              <details>
                <summary>{item.displayName}</summary>
                <ul class="p-2">
                  {item.children.map((child) => (
                    <li>
                      <a href={child.path} class:list={[isActive(child.path) ? "active" : ""]}>
                        {child.displayName}
                      </a>
                    </li>
                  ))}
                </ul>
              </details>
            </li>
          )
        ))}
      </ul>
    </div>
  </div>
</div>
